<div class="dashboard">
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <h2>ğŸ“ SGE</h2>
    </div>
    <ul class="menu">
      <li><a routerLink="/dashboard"><span>ğŸ </span> Dashboard</a></li>
      <li><a routerLink="/perfil" class="active"><span>ğŸ‘¤</span> Mi Perfil</a></li>
      <li><a (click)="logout()" class="logout"><span>ğŸšª</span> Cerrar SesiÃ³n</a></li>
    </ul>
  </nav>

  <!-- Main Content -->
  <main class="content">
    <div class="container">
      <div class="header">
        <h1>ğŸ‘¤ Mi Perfil</h1>
        <p class="subtitle">Administra tu informaciÃ³n personal</p>
      </div>

      <div class="profile-grid">
        <!-- Card de InformaciÃ³n Personal -->
        <div class="profile-card">
          <div class="card-header">
            <h2>ğŸ“ InformaciÃ³n Personal</h2>
          </div>
          
          <div class="user-avatar-section">
            <div class="user-avatar-large">
              {{ currentUser?.nombre?.charAt(0) || 'U' }}
            </div>
            <div class="user-info-summary">
              <h3>{{ currentUser?.nombre }}</h3>
              <span class="role-badge" [ngClass]="'role-' + currentUser?.rol">
                {{ getRoleName(currentUser?.rol || '') }}
              </span>
            </div>
          </div>

          <form [formGroup]="perfilForm" (ngSubmit)="updateProfile()">
            <div class="form-group">
              <label>Nombre Completo</label>
              <input 
                type="text" 
                formControlName="nombre"
                [class.invalid]="perfilForm.get('nombre')?.invalid && perfilForm.get('nombre')?.touched"
              />
              <span 
                class="error" 
                *ngIf="perfilForm.get('nombre')?.invalid && perfilForm.get('nombre')?.touched"
              >
                El nombre es requerido (mÃ­nimo 3 caracteres)
              </span>
            </div>

            <div class="form-group">
              <label>Correo ElectrÃ³nico</label>
              <input 
                type="email" 
                formControlName="email"
                [class.invalid]="perfilForm.get('email')?.invalid && perfilForm.get('email')?.touched"
              />
              <span 
                class="error" 
                *ngIf="perfilForm.get('email')?.invalid && perfilForm.get('email')?.touched"
              >
                Ingrese un email vÃ¡lido
              </span>
            </div>

            <button 
              type="submit" 
              class="btn-primary"
              [disabled]="perfilForm.invalid || loading"
            >
              {{ loading ? 'Guardando...' : 'Guardar Cambios' }}
            </button>
          </form>
        </div>

        <!-- Card de Seguridad -->
        <div class="profile-card">
          <div class="card-header">
            <h2>ğŸ”’ Seguridad</h2>
          </div>

          <div class="security-info">
            <div class="info-item">
              <span class="info-label">ID de Usuario:</span>
              <span class="info-value">#{{ currentUser?.id }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Rol:</span>
              <span class="info-value">{{ getRoleName(currentUser?.rol || '') }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Estado:</span>
              <span class="status-badge" [class.active]="currentUser?.activo">
                {{ currentUser?.activo ? 'Activo' : 'Inactivo' }}
              </span>
            </div>
          </div>

          <button 
            class="btn-secondary full-width"
            (click)="showPasswordSection = !showPasswordSection"
          >
            {{ showPasswordSection ? 'âœ• Cancelar' : 'ğŸ”‘ Cambiar ContraseÃ±a' }}
          </button>

          <form 
            *ngIf="showPasswordSection" 
            [formGroup]="passwordForm" 
            (ngSubmit)="updatePassword()"
            class="password-form"
          >
            <div class="form-group">
              <label>ContraseÃ±a Actual</label>
              <input 
                type="password" 
                formControlName="currentPassword"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                [class.invalid]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched"
              />
            </div>

            <div class="form-group">
              <label>Nueva ContraseÃ±a</label>
              <input 
                type="password" 
                formControlName="newPassword"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                [class.invalid]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
              />
              <span 
                class="error" 
                *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
              >
                MÃ­nimo 6 caracteres
              </span>
            </div>

            <div class="form-group">
              <label>Confirmar Nueva ContraseÃ±a</label>
              <input 
                type="password" 
                formControlName="confirmPassword"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                [class.invalid]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched"
              />
              <span 
                class="error" 
                *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmPassword')?.touched"
              >
                Las contraseÃ±as no coinciden
              </span>
            </div>

            <button 
              type="submit" 
              class="btn-primary full-width"
              [disabled]="passwordForm.invalid || loading"
            >
              {{ loading ? 'Actualizando...' : 'Actualizar ContraseÃ±a' }}
            </button>
          </form>
        </div>
      </div>

      <!-- Card de Ayuda -->
      <div class="help-card">
        <div class="help-icon">ğŸ’¡</div>
        <div class="help-content">
          <h3>Â¿Necesitas ayuda?</h3>
          <p>Si tienes problemas para actualizar tu perfil o contraseÃ±a, contacta al administrador del sistema.</p>
        </div>
      </div>
    </div>
  </main>
</div>
